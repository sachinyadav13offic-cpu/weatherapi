<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather Analytics Dashboard</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2980, #26d0ce);
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .sky {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 40%;
            z-index: -1;
            overflow: hidden;
        }
        
        .cloud {
            position: absolute;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
        }
        
        .cloud:before, .cloud:after {
            content: '';
            position: absolute;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
        }
        
        .cloud1 {
            width: 120px;
            height: 40px;
            top: 20%;
            left: 10%;
        }
        
        .cloud1:before {
            width: 50px;
            height: 50px;
            top: -20px;
            left: 15px;
        }
        
        .cloud1:after {
            width: 70px;
            height: 70px;
            top: -30px;
            left: 40px;
        }
        
        .cloud2 {
            width: 180px;
            height: 60px;
            top: 15%;
            left: 40%;
        }
        
        .cloud2:before {
            width: 70px;
            height: 70px;
            top: -30px;
            left: 20px;
        }
        
        .cloud2:after {
            width: 90px;
            height: 90px;
            top: -40px;
            left: 60px;
        }
        
        .cloud3 {
            width: 150px;
            height: 50px;
            top: 30%;
            left: 70%;
        }
        
        .cloud3:before {
            width: 60px;
            height: 60px;
            top: -25px;
            left: 15px;
        }
        
        .cloud3:after {
            width: 80px;
            height: 80px;
            top: -35px;
            left: 50px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            padding: 30px 0;
            margin-bottom: 30px;
        }
        
        h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .stats-container {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            width: 200px;
            margin: 10px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.18);
            transition: transform 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .stat-label {
            font-size: 1rem;
            opacity: 0.8;
        }
        
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.18);
            transition: transform 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .card-title {
            font-size: 1.2rem;
            font-weight: bold;
        }
        
        .chart-container {
            height: 250px;
        }
        
        footer {
            text-align: center;
            padding: 20px;
            margin-top: 30px;
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            font-size: 1.2rem;
        }
        
        @media (max-width: 768px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .stat-card {
                width: 100%;
                max-width: 300px;
            }
        }
    </style>
</head>
<body>
    <div class="sky">
        <div class="cloud cloud1"></div>
        <div class="cloud cloud2"></div>
        <div class="cloud cloud3"></div>
    </div>
    
    <div class="container">
        <header>
            <h1>Weather Analytics Dashboard</h1>
            <p class="subtitle">Real-time weather data visualization and analysis</p>
        </header>
        
        <div class="stats-container">
            <div class="stat-card">
                <div class="stat-value" id="dataCount">0</div>
                <div class="stat-label">Total Records</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="citiesCount">0</div>
                <div class="stat-label">Cities/Locations</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="updateCount">0</div>
                <div class="stat-label">Updates Today</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="lastUpdateTime">--:--</div>
                <div class="stat-label">Last Updated</div>
            </div>
        </div>
        
        <div class="charts-grid">
            <div class="card">
                <div class="card-header">
                    <div class="card-title">Wind Speed</div>
                </div>
                <div class="chart-container" id="wind_speed">
                    <div class="loading">Loading wind speed data...</div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <div class="card-title">Wind Gust</div>
                </div>
                <div class="chart-container" id="wind_gust">
                    <div class="loading">Loading wind gust data...</div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <div class="card-title">Temperature</div>
                </div>
                <div class="chart-container" id="temperature">
                    <div class="loading">Loading temperature data...</div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <div class="card-title">Humidity</div>
                </div>
                <div class="chart-container" id="humidity">
                    <div class="loading">Loading humidity data...</div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <div class="card-title">Precipitation</div>
                </div>
                <div class="chart-container" id="precipitation">
                    <div class="loading">Loading precipitation data...</div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <div class="card-title">Conditions</div>
                </div>
                <div class="chart-container" id="conditions">
                    <div class="loading">Loading conditions data...</div>
                </div>
            </div>
        </div>
        
        <footer>
            <p>Weather Analytics Dashboard &copy; 2025 | Real-time data updates every 60 seconds</p>
        </footer>
    </div>

    <script>
        // Cloud Animation
        function animateClouds() {
            const clouds = document.querySelectorAll('.cloud');
            let windSpeed = 0.5; // Base wind speed
            
            // Update wind speed based on time of day (simulating changing conditions)
            function updateWindSpeed() {
                const hour = new Date().getHours();
                // Higher wind during midday, lower at night
                if (hour >= 10 && hour <= 16) {
                    windSpeed = 0.8 + Math.random() * 0.4;
                } else {
                    windSpeed = 0.3 + Math.random() * 0.4;
                }
            }
            
            function moveClouds() {
                updateWindSpeed();
                
                clouds.forEach((cloud, index) => {
                    // Each cloud moves at a slightly different speed
                    const speed = windSpeed * (0.5 + index * 0.2);
                    
                    // Get current position
                    let currentLeft = parseFloat(getComputedStyle(cloud).left);
                    
                    // Move cloud to the right
                    currentLeft += speed;
                    
                    // If cloud moves off screen, reset to left side
                    if (currentLeft > window.innerWidth + 200) {
                        currentLeft = -200;
                        // Also randomize vertical position when resetting
                        cloud.style.top = `${Math.random() * 70 + 5}%`;
                    }
                    
                    // Apply new position
                    cloud.style.left = `${currentLeft}px`;
                });
                
                requestAnimationFrame(moveClouds);
            }
            
            moveClouds();
        }
        
        // Load real weather data from your database
        async function loadWeatherData() {
            try {
                const response = await fetch('/get_data');
                const json = await response.json();

                if (json.status !== 'success' || !json.data) {
                    console.error('No data found in database. Using sample data.');
                    useSampleData();
                    return;
                }

                const records = json.data;
                
                // Update stats with real data
                document.getElementById('dataCount').innerText = records.length;

                // Unique city/location count
                const uniqueLocations = new Set(records.map(r => r.City || r.LOCNO || r.State || 'Unknown')).size;
                document.getElementById('citiesCount').innerText = uniqueLocations;

                // Update count today
                const today = new Date().toISOString().split('T')[0];
                const todayCount = records.filter(r => {
                    const recordDate = new Date(r.ForecastDate).toISOString().split('T')[0];
                    return recordDate === today;
                }).length;
                document.getElementById('updateCount').innerText = todayCount;

                // Extract arrays for charts - using the actual field names from your database
                const hours = records.map(r => {
                    const date = new Date(r.ForecastDate);
                    return date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                });
                const windSpeed = records.map(r => r.WindSpeed || 0);
                const windGust = records.map(r => r.WindGust || 0);
                const temperature = records.map(r => r.Temp || 0);
                const humidity = records.map(r => r.Humidity || 0);
                const precipitation = records.map(r => r.Precip || 0);
                const conditions = records.map(r => r.Conditions || 5);

                // Create charts with real data
                createCharts({
                    hours,
                    windSpeed,
                    windGust,
                    temperature,
                    humidity,
                    precipitation,
                    conditions
                });

                // Timestamp update
                document.getElementById('lastUpdateTime').innerText = new Date().toLocaleString();

            } catch (error) {
                console.error('Error fetching data:', error);
                useSampleData();
            }
        }
        
        // Create charts with real or sample data
        function createCharts(data) {
            // Remove loading messages
            document.querySelectorAll('.loading').forEach(el => el.remove());
            
            // Wind Speed Chart
            Plotly.newPlot('wind_speed', [{
                x: data.hours,
                y: data.windSpeed,
                type: 'scatter',
                mode: 'lines+markers',
                line: { 
                    color: '#1a2980', 
                    width: 4,
                    shape: 'spline'
                },
                marker: { 
                    size: 8,
                    color: '#26d0ce'
                },
                fill: 'tozeroy',
                fillcolor: 'rgba(26, 41, 128, 0.1)',
                name: 'Wind Speed (km/h)'
            }], {
                title: '',
                xaxis: { 
                    title: 'Time',
                    gridcolor: 'rgba(0,0,0,0.1)'
                },
                yaxis: { 
                    title: 'Wind Speed (km/h)',
                    gridcolor: 'rgba(0,0,0,0.1)'
                },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: { color: '#1a2980' },
                showlegend: false,
                margin: { t: 10 }
            });
            
            // Wind Gust Chart
            Plotly.newPlot('wind_gust', [{
                x: data.hours,
                y: data.windGust,
                type: 'scatter',
                mode: 'lines+markers',
                line: { 
                    color: '#e74c3c', 
                    width: 4,
                    shape: 'spline'
                },
                marker: { 
                    size: 8,
                    color: '#ff9f43'
                },
                fill: 'tozeroy',
                fillcolor: 'rgba(231, 76, 60, 0.1)',
                name: 'Wind Gust (km/h)'
            }], {
                title: '',
                xaxis: { 
                    title: 'Time',
                    gridcolor: 'rgba(0,0,0,0.1)'
                },
                yaxis: { 
                    title: 'Wind Gust (km/h)',
                    gridcolor: 'rgba(0,0,0,0.1)'
                },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: { color: '#1a2980' },
                showlegend: false,
                margin: { t: 10 }
            });
            
            // Temperature Chart
            Plotly.newPlot('temperature', [{
                x: data.hours,
                y: data.temperature,
                type: 'scatter',
                mode: 'lines+markers',
                line: { 
                    color: '#ff9f43', 
                    width: 4,
                    shape: 'spline'
                },
                marker: { 
                    size: 8,
                    color: '#e74c3c'
                },
                fill: 'tozeroy',
                fillcolor: 'rgba(255, 159, 67, 0.1)',
                name: 'Temperature (°C)'
            }], {
                title: '',
                xaxis: { 
                    title: 'Time',
                    gridcolor: 'rgba(0,0,0,0.1)'
                },
                yaxis: { 
                    title: 'Temperature (°C)',
                    gridcolor: 'rgba(0,0,0,0.1)'
                },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: { color: '#1a2980' },
                showlegend: false,
                margin: { t: 10 }
            });
            
            // Humidity Chart
            Plotly.newPlot('humidity', [{
                x: data.hours,
                y: data.humidity,
                type: 'scatter',
                mode: 'lines+markers',
                line: { 
                    color: '#3498db', 
                    width: 4,
                    shape: 'spline'
                },
                marker: { 
                    size: 8,
                    color: '#1a2980'
                },
                fill: 'tozeroy',
                fillcolor: 'rgba(52, 152, 219, 0.1)',
                name: 'Humidity (%)'
            }], {
                title: '',
                xaxis: { 
                    title: 'Time',
                    gridcolor: 'rgba(0,0,0,0.1)'
                },
                yaxis: { 
                    title: 'Humidity (%)',
                    gridcolor: 'rgba(0,0,0,0.1)'
                },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: { color: '#1a2980' },
                showlegend: false,
                margin: { t: 10 }
            });
            
            // Precipitation Chart
            Plotly.newPlot('precipitation', [{
                x: data.hours,
                y: data.precipitation,
                type: 'bar',
                marker: { 
                    color: '#9b59b6',
                    opacity: 0.7
                },
                name: 'Precipitation (mm)'
            }], {
                title: '',
                xaxis: { 
                    title: 'Time',
                    gridcolor: 'rgba(0,0,0,0.1)'
                },
                yaxis: { 
                    title: 'Precipitation (mm)',
                    gridcolor: 'rgba(0,0,0,0.1)'
                },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: { color: '#1a2980' },
                showlegend: false,
                margin: { t: 10 }
            });
            
            // Conditions Chart
            Plotly.newPlot('conditions', [{
                x: data.hours,
                y: data.conditions,
                type: 'scatter',
                mode: 'lines+markers',
                line: { 
                    color: '#2ecc71', 
                    width: 4,
                    shape: 'spline'
                },
                marker: { 
                    size: 8,
                    color: '#27ae60'
                },
                fill: 'tozeroy',
                fillcolor: 'rgba(46, 204, 113, 0.1)',
                name: 'Conditions Index'
            }], {
                title: '',
                xaxis: { 
                    title: 'Time',
                    gridcolor: 'rgba(0,0,0,0.1)'
                },
                yaxis: { 
                    title: 'Conditions Index',
                    gridcolor: 'rgba(0,0,0,0.1)',
                    range: [0, 10]
                },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: { color: '#1a2980' },
                showlegend: false,
                margin: { t: 10 }
            });
        }
        
        // Generate sample weather data as fallback
        function generateWeatherData() {
            const now = new Date();
            const hours = [];
            const windSpeed = [];
            const windGust = [];
            const temperature = [];
            const humidity = [];
            const precipitation = [];
            const conditions = [];
            
            // Generate data for the last 24 hours
            for (let i = 0; i < 24; i++) {
                const time = new Date(now);
                time.setHours(now.getHours() - 23 + i);
                const hourStr = time.getHours().toString().padStart(2, '0');
                hours.push(`${hourStr}:00`);
                
                // Generate realistic weather data with some patterns
                const baseTemp = 15 + 5 * Math.sin(i * Math.PI / 12); // Temperature follows a daily pattern
                temperature.push(+(baseTemp + (Math.random() - 0.5) * 3).toFixed(1));
                
                // Wind follows a pattern with some randomness
                const baseWind = 5 + 3 * Math.sin(i * Math.PI / 6);
                windSpeed.push(+(baseWind + Math.random() * 5).toFixed(1));
                windGust.push(+(windSpeed[i] + Math.random() * 8).toFixed(1));
                
                // Humidity tends to be higher at night
                const baseHumidity = 50 + 20 * Math.sin(i * Math.PI / 12 + Math.PI/2);
                humidity.push(+(baseHumidity + (Math.random() - 0.5) * 15).toFixed(0));
                
                // Precipitation chance follows a pattern
                const precipChance = Math.max(0, Math.sin(i * Math.PI / 8) * 10);
                precipitation.push(+(precipChance * Math.random()).toFixed(1));
                
                // Conditions index (0-10, where 10 is perfect weather)
                conditions.push(+(5 + 3 * Math.sin(i * Math.PI / 12) + (Math.random() - 0.5) * 2).toFixed(1));
            }
            
            return {
                hours,
                windSpeed,
                windGust,
                temperature,
                humidity,
                precipitation,
                conditions
            };
        }
        
        // Use sample data when real data is unavailable
        function useSampleData() {
            const data = generateWeatherData();
            createCharts(data);
            
            // Update stats with sample data
            document.getElementById('dataCount').textContent = Math.floor(Math.random() * 50) + 120;
            document.getElementById('citiesCount').textContent = Math.floor(Math.random() * 5) + 10;
            document.getElementById('updateCount').textContent = Math.floor(Math.random() * 10) + 40;
            document.getElementById('lastUpdateTime').textContent = new Date().toLocaleString();
        }
        
        // Initialize everything when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Start cloud animation
            animateClouds();
            
            // Try to load real data, fall back to sample data if unavailable
            loadWeatherData();
            
            // Update time every second
            setInterval(() => {
                document.getElementById('lastUpdateTime').textContent = new Date().toLocaleString();
            }, 1000);
            
            // Update data every 60 seconds
            setInterval(loadWeatherData, 60000);
            
            // Add smooth loading animation
            const cards = document.querySelectorAll('.card');
            cards.forEach((card, index) => {
                card.style.opacity = '0';
                card.style.transform = 'translateY(20px)';
                
                setTimeout(() => {
                    card.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
                    card.style.opacity = '1';
                    card.style.transform = 'translateY(0)';
                }, index * 100);
            });
        });
    </script>
</body>
</html>